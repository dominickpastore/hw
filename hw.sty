%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Homework Package for Math and Computer Science
% ==============================================
% Dominick C. Pastore
%
% Can fully format an article-class document or can be applied to an existing
% document (e.g. a problem set supplied by the professor) to add some
% convenience features.
%
% Package options (e.g. "\usepackage[bare,nocs]{hw}"):
% ----------------------------------------------------
%
% bare - Don't fully-format the page with margins, fancyhdr, and custom
%   \maketitle. Just provide convenience features like \comma, \R, the problems
%   environment, nicely configured listings.
% nocs - Don't provide computer science features (listings package with
%   preconfigured format settings)
% nomath - Don't provide math features (convenience commands for use in math
%   mode or classes of numbers like \mathbb{R} for reals)
%
% Problem sets
% ------------
%
% A great majority of homework assignments in math and computer science are a
% list of problems. A well-written assignment includes the question before the
% answer, but if they are just typed one after the other, they will blend
% together. Solving this is perhaps the main purpose of this package. The
% following environments and commands provide ways to nicely typeset a list of
% questions and answers with the questions in boldface to set them off from the
% answers.
%
% \begin{problems}...\end{problems}
% \begin{problems}[<label-text>]..\end{problems}
% \begin{subproblems}...\end{subproblems}
% \begin{subproblems}[<label-text>]..\end{subproblems}
%   Creates a new enumerated problems list. Create new questions with the
%   \question{} command below. If the optional arument is provided, it is used
%   to determine the label for questions (see the "label" key in the enumitem
%   package, which the argument is fed to). Answers go unenclosed after the
%   question.
%
%   The difference between problems and subproblems is that the latter has some
%   hanging indentation and the former does not. While either can be nested
%   without error (just like regular enumerate), the intention is that the top
%   level of problems should not have a hanging indent since there likely is
%   not other text in the document for the list to be set off from. Meanwhile,
%   subproblems should be set off from their parent problem, so they do need
%   indentation.
%
% \begin{problems*}...\end{problems*}
% \begin{subproblems*}...\end{subproblems*}
%   Creates a new unenumerated problems list. Questions do not have numbers
%   before them and paragraphs are separated using the normal methods for body
%   text (i.e a first line indent rather than being separated by a little
%   space, unless that's been changed for the rest of the document).
%   Essentially, get a problems list without it looking like a list.
%   However, it still technically is a list, and thus other problems lists can
%   be nested inside.
%
%   Note that if you *want* list-like formatting similar to the unstarred
%   problems environment, just without numbers, you might consider using the
%   parskip package, or else simply modifying \parskip and \parindent:
%
%     \usepackage{parskip}
%     % -or-
%     \setlength{\parindent}{0pt}
%     \setlength{\parskip}{0.5em}
%
%   Like regular problems vs. subproblems, subproblems* has a hanging indent
%   while problems* does not. However, nested lists of unnumbered problems are
%   fairly uncommon. Even if you do have them, you may not want the extra
%   indentation from subproblems*. But, it's there if you need it. (If you have
%   a numbered problem with multiple unnumbered parts to it, consider using
%   \followup.)
%
% \question{...}
%   Creates a new question. Can be used in one of the environments above or on
%   its own. Question will be in bold. If used outside the environments above,
%   note that no spacing will be added, which might look funny. This is to
%   avoid interfering with any spacing a .tex file provided by a professor
%   might already have. If you do want the spacing, consider the problems*
%   environment.
%
% \followup{...}
%   Adds an additional unnumbered part to a numbered question. (This is not
%   meant to be used inside the unnumbered problems* and subproblems*
%   environments.) This is useful if you have a problem with follow-up
%   questions after the main question, for example:
%
%     1. The UPS driver wasn't paying attention and accidentally tossed your
%        package on the roof. If the angle of the roof is 30 degrees and the
%        box weighs 2kg, calculate the component of gravitational force that's
%        perpendicular to the roof and the component that's parallel.
%
%        If the coefficient of static friction is 0.8, will the box start
%        sliding down the roof?
%
%   The difference between this and using a nested problems* environment is
%   that problems* uses regular body-paragraph-style indentation and spacing,
%   while this uses the same paragraph formatting as the rest of the list it's
%   in.
%
% Page Formatting
% ---------------
%
% If starting a homework assignment from scratch, this package can format the
% page nicely for you. It will set up margins, headers and footers, and
% customize the \maketitle command for a basic homework assignment.
%
% Sometimes, you are starting from a template provided by the professor. In
% that case, you probably don't want all the extra page formatting, just the
% convenience commands and environments. In that case, use the "bare" option to
% skip all this.
%
% Without the bare option, the following always happens:
% - Letter paper size
% - Margins set to 1.25in (with headers and footers using some of the top and
%   bottom margin space)
% - Page number in the footer
% - Pages without the title get a header with the class, assignment, and author
%
% What happens on the first page depends on if there is a title set or not.
% Note that the title is separate from the assignment name.
%
% Many homework assignments will be untitled, such as run-of-the-mill problem
% sets. These still have an assignment name (e.g. "Homework 1"). For these, the
% \maketitle command is customized to print the assignment name in centered,
% bold, sans-serif text, and the header on that page contains the date in place
% of the assignment.
%
% Titled assignments, such as perhaps papers, do not have a header at all on
% the page with the title. Instead, below the title, the class, date, and
% author appear. TODO implement this!
%
% The title (for titled assignments), author, and date are all set using the
% usual commands. The class name and assignment name are set using the
% following commands:
%
% \class{...}
%   Set the name of the class for this assignment, e.g. \class{CIS 500}
%
% \assignment{...}
%   Set the name of the assignment, e.g. \assignment{Homework 1}
%
% Math Conveniences
% -----------------
%
% If the "nomath" option is not provided, the following commands are provided
% for use in math mode:
%
% \N
% \Z
% \Q
% \R
% \C
%   Insert the blackboard-bold version of that letter in math mode,
%   representing the common classes of numbers (naturals, integers, rationals,
%   reals, complex numbers)
%
% \andop
% \orop
%   Insert the word "and" or "or" in math mode in upright style, for situations
%   where you would rather write out the word instead of using \vee or \wedge
%
% \period
% \comma
%   Insert a period or comma in math mode. Meant to be used at the end of
%   display math when the display math ends a phrase or sentence.
%
% Finally, the "mleftright" package is loaded for access to the \mleft and
% \mright commands.
%
% Computer Science Conveniences
% -----------------------------
%
% If the "nocs" option is not provided, the "listings" package is loaded and
% preconfigured for nice-looking code listings. The default format is meant to
% be used in floats. If not using a float, add "style=fixed" to the listing to
% ensure it gets a little space on either side of it.
%
% TODO Make this documentation the proper LaTeX way
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{hw}[2020/09/18 LaTeX package for homework assignments]

\RequirePackage[T1]{fontenc}
\RequirePackage{amsmath,amsthm,amssymb}
\RequirePackage{enumitem}
\RequirePackage{xifthen}

% Package options
\newif\if@fancyhw\@fancyhwtrue
\DeclareOption{bare}{
  \@fancyhwfalse
}
\newif\if@cshw\@cshwtrue
\DeclareOption{nocs}{
  \@cshwfalse
}
\newif\if@mathhw\@mathhwtrue
\DeclareOption{nomath}{
  \@mathhwfalse
}
\DeclareOption*{\PackageWarning{examplepackage}{Unknown `\CurrentOption'}}
\ProcessOptions\relax

% Page formatting (skipped with "bare" option)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\if@fancyhw
\RequirePackage[margin=1.25in,headheight=1.25em,headsep=1em]{geometry}
\RequirePackage{fancyhdr}

% Assignment info commands
\newcommand{\hw@class}{\@empty}
\newcommand{\class}[1]{\renewcommand{\hw@class}{#1}}
\newcommand{\hw@assignment}{\@empty}
\newcommand{\assignment}[1]{\renewcommand{\hw@assignment}{#1}}

% Headers and footers
\pagestyle{fancy}
\lhead{\hw@class}
\chead{\hw@assignment}
\rhead{\@author}
\fancypagestyle{firstpage}{%
  \lhead{\hw@class}
  \chead{\@date}
  \rhead{\@author}
}

% Custom title format
\title{}
\renewcommand{\maketitle}{%
  \ifthenelse{\equal{\@title}{}}{%
    \thispagestyle{firstpage}
    {\centering\bfseries\sffamily\LARGE\hw@assignment\par}
  }{%
    %TODO Do something better when there is an actual title
  }
}

\fi

% Question/answer formatting
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newif\if@hwproblems\@hwproblemsfalse
\newif\if@hwproblemsstar\@hwproblemsstarfalse

% Question/answer environment
% Optional argument is for label text, using \arabic*, \alph*, \Alph*, \roman*,
%   and \Roman*, e.g. \Alph*) for A)
% Inside, use \question{Question text} to start each question or problem.
\newenvironment{problems}[1][]{%
  \@hwproblemstrue
  \ifthenelse{\isempty{#1}}{%
    \begin{enumerate}[parsep=0.5em,font=\bfseries,
        align=left,leftmargin=0pt,labelindent=0pt,itemindent=!]
  }{%
    \begin{enumerate}[parsep=0.5em,label=\textbf{#1},
        align=left,leftmargin=0pt,labelindent=0pt,itemindent=!]
  }
}{%
  \end{enumerate}
  \@hwproblemsfalse
}

% Subquestion/answer environment. Like above, but with a hanging indent.
\newenvironment{subproblems}[1][]{%
  \@hwproblemstrue
  \ifthenelse{\isempty{#1}}{%
    \begin{enumerate}[parsep=0.5em,font=\bfseries]
  }{%
    \begin{enumerate}[parsep=0.5em,label=\textbf{#1}]
  }
}{%
  \end{enumerate}
  \@hwproblemsfalse
}

% Left-aligned-label subquestion/answer environment. If the question labels are
% too long, they stick out past the left margin on a regular subproblems
% environment (e.g. if the label is "Problem \arabic*."). This environment
% accounts for that by using a left-aligned label, which extends into the
% question body rather than the margin. This isn't the default, though, because
% the spacing looks bad for regular-size (i.e. short) labels.
\newenvironment{lsubproblems}[1][]{%
  \@hwproblemstrue
  \ifthenelse{\isempty{#1}}{%
    \begin{enumerate}[parsep=0.5em,font=\bfseries,align=left]
  }{%
    \begin{enumerate}[parsep=0.5em,label=\textbf{#1},align=left]
  }
}{%
  \end{enumerate}
  \@hwproblemsfalse
}

% Unnumbered question/answer environment. Still use \question{Question text}.
\newenvironment{problems*}{%
  \@hwproblemstrue
  \@hwproblemsstartrue
  \begin{itemize}[
    parsep=\parskip,
    itemindent=\parindent,
    listparindent=\parindent,
    leftmargin=0pt,
    label={}]
}{%
  \end{itemize}
  \@hwproblemsfalse
  \@hwproblemsstarfalse
}

% Unnumbered subquestion/answer environment. Like problems* but with a hanging
% indent.
\newenvironment{subproblems*}{%
  \@hwproblemstrue
  \@hwproblemsstartrue
  \begin{itemize}[
    parsep=\parskip,
    itemindent=\parindent,
    listparindent=\parindent,
    label={}]
}{%
  \end{itemize}
  \@hwproblemsfalse
  \@hwproblemsstarfalse
}

% Start a new question or problem. Question/problem is bolded.
% Argument is the question or problem text. It's printed in bold.
\newcommand{\question}[1]{%
  \if@hwproblems\item\fi
  {\bfseries\boldmath #1}%
  \if@hwproblemsstar\vspace{0.5em}\fi
}

% Add an additional unnumbered part to a numbered question. Useful when you
% have a question where there are follow ups after the main question. Not
% meant to be used for problems* or subproblems*, where questions are
% unnumbered to begin with.
\newcommand{\followup}[1]{%
  {\bfseries\boldmath #1}%
  \if@hwproblemsstar\vspace{0.5em}\fi
}

% Nice code listings (skipped with "nocs" option)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\if@cshw
\RequirePackage[lighttt]{lmodern}
\RequirePackage{listings}
\RequirePackage{graphicx}
%\RequiresPackage{algorithmicx}
%\RequiresPackage{algorithm}
%\RequiresPackage{algpseudocode}

% Workaround for bug with light italic tt
% See https://tex.stackexchange.com/a/234020
\ttfamily
\DeclareFontShape{T1}{lmtt}{m}{it}
     {<->sub*lmtt/m/sl}{}

% Listing configuration
\lstset{
  numbers=left,
  xleftmargin=1em,
  frame=single,
  frameround=tttt,
  belowcaptionskip=3ex,
  basicstyle=\ttfamily,
  basewidth={0.5em,0.5em},
  stepnumber=5,
  numberstyle=\tiny, %line numbers
  breaklines=true
}
\lstdefinestyle{fixed}{
  aboveskip=1em,
  belowskip=1em
}

\fi

% Math convenience commands (skipped with "nomath" option)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\if@mathhw
\RequirePackage{mleftright}

% Sets of numbers
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}

% Written out logical connectives for use in mathematical formulae
% (\andop, \orop)
\DeclareMathOperator\andoper{and}
\DeclareMathOperator\oroper{or}
\newcommand{\andop}{\mathbin{\andoper}}
\newcommand{\orop}{\mathbin{\oroper}}

% Comma and period for use with display math (if the math is the end of a
% phrase or sentence)
\newcommand{\period}{\,\text{.}}
\newcommand{\comma}{\,\text{,}}

\fi

\endinput
